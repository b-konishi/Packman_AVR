;
; AsmPackman.asm
;
; Created: 2015/10/07 19:46:17
; Author : Admin
;

.include "ATxmega32D4def.inc"

; Replace with your application code
.DEF TMP = R16
.DEF LOWER = R17
.DEF HIGHER = R18
.DEF TIME = R19
.DEF CLOCK = R20

LDS		CLOCK, OSC_CTRL
ORI		CLOCK, 0x02
STS		OSC_CTRL, CLOCK
BITWAIT:
	LDS		CLOCK, OSC_STATUS
	ANDI	CLOCK, 0x02
	BREQ	BITWAIT
LDI		CLOCK, 0xD8
STS		CPU_CCP, CLOCK
LDI		CLOCK, 0x01
STS		CLK_CTRL, CLOCK
LDI		CLOCK, 0xFE
ANDI	CLOCK, OSC_CTRL
STS		OSC_CTRL, CLOCK

START:
	LDI		TMP, 0xff
	STS		PORTC_DIR, TMP
	LDI		LOWER, 0x00
	LDI		HIGHER, 0x01
	STS		PORTC_OUT, LOWER

LOOP:
	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT350N
	STS		PORTC_OUT, LOWER
	CALL	WAIT1360N


	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N

	STS		PORTC_OUT, HIGHER
	CALL	WAIT1360N
	STS		PORTC_OUT, LOWER
	CALL	WAIT350N
	

	CALL	WAIT50U
	RJMP	LOOP


MAIN:
	RJMP	MAIN

WAIT50U:
	LDI		TIME, 25
WAIT50U_LOOP:
	CALL	WAIT2000N
	DEC		TIME
	BRNE	WAIT50U_LOOP
	RET

WAIT2000N:
	CALL	WAIT500N
	CALL	WAIT500N
	CALL	WAIT500N
	CALL	WAIT500N
	RET

WAIT1360N:
	CALL	WAIT1200N
	NOP
	NOP
	NOP
	NOP
	RET

WAIT1300N:
	CALL	WAIT1200N
	NOP
	NOP
	RET

WAIT1200N:
	CALL	WAIT500N
	CALL	WAIT500N
	CALL	WAIT100N
	NOP
	NOP
	RET

WAIT500N:
	CALL	WAIT100N
	CALL	WAIT100N
	CALL	WAIT100N
	CALL	WAIT100N
	RET

WAIT350N:
	CALL	WAIT100N
	CALL	WAIT100N
	CALL	WAIT100N
	RET

WAIT100N:
	NOP
	NOP
	RET


